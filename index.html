<!DOCTYPE html>
<html lang="es">

<head>

    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta charset="utf-8">
    <script type="text/javascript" src="https://d3js.org/d3.v7.min.js"></script>
    <script src="sp.js"></script>

    <link rel="icon" type="image/x-icon" href="fav.ico">
    <style>
        * {
            font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
            margin: 0;
            padding: 0;
        }

        body {
            background: linear-gradient(90deg, rgb(125, 125, 255), rgb(175, 175, 255));
        }

        .bar {
            transition-duration: 0.2s;
        }

        .bar:hover {
            fill: rgba(255, 255, 255, 0.2);
        }

        #sas {
            background-color: rgb(116, 28, 230);
            width: min-content;
            margin: auto;
        }

        #bosque {
            background-color: rgb(35, 214, 214);
        }

        #divbutton {
            background-color: rgb(125, 125, 255);
            padding: 10px;
        }

        form {
            background-color: rgb(196, 241, 104);
            box-sizing: content-box;
            padding: 10px;
        }

        form li {
            display: inline-block;
            list-style: none;
        }

        select {
            width: 100px;

        }

        .sas-div {
            display: inline-block;
        }

        .hide_class {
            display: none;
        }
    </style>
</head>

<body>
    <main>
        <div id="sas">
            <div id="bosque">
                <div class="sas-div">
                    <form id="forma">
                        <ul>
                            <li>
                                <div>
                                    <select name="age">
                                        <option value=""> </option>
                                    </select>
                                </div>
                            </li>
                            <li>
                                <div>
                                    <select name="ciclo">
                                        <option value=""> </option>
                                        <option value="ciclo_I" class="hide_class">Ciclo I</option>
                                        <option value="ciclo_II" class="hide_class">Ciclo II</option>
                                        <option value="ciclo_III" class="hide_class">Ciclo III</option>
                                        <option value="ciclo_IV" class="hide_class">Ciclo IV</option>
                                    </select>
                                </div>
                            </li>
                            <li>
                                <div>
                                    <select name="examen">
                                        <option value=""> </option>
                                        <option value="examen_I" class="hide_class">1° Examen</option>
                                        <option value="examen_II" class="hide_class">2° Examen</option>
                                        <option value="examen_III" class="hide_class">3° Examen</option>
                                        <option value="examen_Iv" class="hide_class">4° Examen</option>
                                    </select>
                                </div>
                            </li>
                            <li>
                                <div>
                                    <select name="zona">
                                        <option value="" class="hide_class"> </option>
                                        <option value="zona_I" class="hide_class">Zona I</option>
                                        <option value="zona_II" class="hide_class">Zona II</option>
                                        <option value="zona_III" class="hide_class">zona III</option>
                                        <option value="zona_IV" class="hide_class">zona IV</option>
                                    </select>
                                </div>
                            </li>
                            <li>
                                <div>
                                    <select name="lugar">
                                        <option value="" class="hide_class"></option>
                                        <option value="" class="hide_class"></option>
                                        <option value="" class="hide_class"></option>
                                        <option value="" class="hide_class"></option>
                                        <option value="" class="hide_class"></option>
                                        <option value="" class="hide_class"></option>
                                    </select>
                                </div>
                            </li>
                        </ul>
                    </form>

                </div>
                <div class="sas-div">
                    <div id="divbutton">
                        <button id="sender">Try it</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        //const form = (document.forms)[0]; select_inf
        const form = document.getElementById('forma')
        const sender = document.getElementById('sender');
        const age_select = form[0]
        const ciclo_select = form[1]
        const examen_select = form[2]
        const zona_select = form[3]
        const lugar_select = form[4]
        //const romanos = ["i", "ii", "iii", "iv", "v"]
        //const puestos = ["1°", "2°", "3°", "4°", "5°"]

        const select_example = document.createElement('select')

        const select_json_url = "https://protonianosaurio.github.io/select/select.json"

        fetch(select_json_url).then(response => {
            return response.json();
        }).then(json_file => {
            const respuesta = json_file
            var aver_si_cambia = 0

            for (i in respuesta) {
                const option = document.createElement('option')
                option.value = i
                option.textContent = i
                age_select.appendChild(option)
            }
            var age_ = ""
            var ciclo_ = ""
            var examen_ =""
            var zona_ = ""

            age_select.addEventListener('change', function () {
                const value = age_select.value
                ciclo_select.selectedIndex = ciclo_select[0]

                hide_examen_selector()
                hide_zona_selector()
                hide_lugar_selector()
                var ciclos = Object.keys(respuesta[value]).length
                for (let i = 1; i < ciclo_select.length; i++) {
                    if (i <= ciclos) {
                        //ciclo_select[i].removeAttribute("class")
                        //ciclo_select[i].classList.remove("hide_class")
                        ciclo_select[i].className = ""
                    } else {
                        //ciclo_select[i].classList.add("hide_class")
                        ciclo_select[i].className = "hide_class"
                    }
                }
                age_ = value
            })

            ciclo_select.addEventListener('change', function () {
                const value = ciclo_select.value;
                examen_select.selectedIndex = examen_select[0]
                hide_zona_selector()
                hide_lugar_selector()    

                var examenes = Object.keys(respuesta[age_][value]).length
                for (let i = 1; i < examen_select.length; i++) {
                    if (i <= examenes) {
                        examen_select[i].className = ""
                    } else {
                        examen_select[i].className = "hide_class"
                    }
                }
                ciclo_ = value;
            })

            examen_select.addEventListener('change', function () {
                const value = examen_select.value;
                zona_select.selectedIndex = zona_select[0]
                hide_lugar_selector()  

                var zonas = Object.keys(respuesta[age_][ciclo_][value]).length

                for (let i = 1; i < zona_select.length; i++) {
                    if (i <= zonas) {
                        zona_select[i].className = ""
                    } else {
                        zona_select[i].className = "hide_class"
                    }
                }
                examen_ = value
            })

            zona_select.addEventListener('change', function () {
                const value = lugar_select.value
                lugar_select.selectedIndex = lugar_select[0]

                lugars = respuesta[age_][ciclo_][examen_][value]
                for(let i = 1; i < lugar_select.length;i++){
                    if(i <= lugars.length){
                        lugar_select[i].value = lugars[i-1]
                        lugar_select[i].textContent = lugars[i-1]
                        lugar_select[i].className = ""
                    }else{
                        lugar_select[i].className = "hide_class"
                    }
                }
            })
        })
        /*
        const rquest = new XMLHttpRequest();

        rquest.open('GET', select_json_url)
        rquest.responseType = 'json';
        rquest.send()

        rquest.onload = function () {
            const respuesta = rquest.response
            var aver_si_cambia = 0

            for (i in respuesta) {
                const option = document.createElement('option')
                option.value = i
                option.textContent = i
                age_select.appendChild(option)
            }
            var age_ = ""
            var ciclo_ = ""

            age_select.addEventListener('change', function () {
                const value = age_select.value
                ciclo_select.selectedIndex = ciclo_select[0]
                hide_examen_selector()
                hide_zona_selector()
                var ciclos = Object.keys(respuesta[value]).length
                for (let i = 1; i < ciclo_select.length - 1; i++) {
                    if (i <= ciclos) {
                        //ciclo_select[i].removeAttribute("class")
                        //ciclo_select[i].classList.remove("hide_class")
                        ciclo_select[i].className = ""
                    } else {
                        //ciclo_select[i].classList.add("hide_class")
                        ciclo_select[i].className = "hide_class"
                    }
                }
                age_ = value
            })

            ciclo_select.addEventListener('change', function () {
                const value = ciclo_select.value;
                examen_select.selectedIndex = examen_select[0]
                hide_zona_selector()

                var examenes = Object.keys(respuesta[age_][value]).length
                for (let i = 1; i < examen_select.length; i++) {
                    if (i <= examenes) {
                        examen_select[i].className = ""
                    } else {
                        examen_select[i].className = "hide_class"
                    }
                }
                ciclo_ = value;
            })

            examen_select.addEventListener('change', function () {
                const value = examen_select.value;
                zona_select.selectedIndex = zona_select[0]

                var zonas = respuesta[age_][ciclo_][value].length

                for (let i = 1; i < zona_select.length; i++) {
                    if (i <= zonas) {
                        zona_select[i].className = ""
                    } else {
                        zona_select[i].className = "hide_class"
                    }
                }
            })
        }

        */

        //for(i in select_inf){
        //    let baca = document.createElement("option")
        //    baca.value = i;
        //    baca.textContent = i;
        //    form[0].appendChild(baca)
        //}
        function hide_examen_selector() {
            examen_select.selectedIndex = examen_select[0]
            for (let i = 1; i < examen_select.length; i++) {
                examen_select[i].className = "hide_class"
            }
        }
        function hide_zona_selector() {
            zona_select.selectedIndex = zona_select[0]
            for (let i = 1; i < zona_select.length; i++) {
                zona_select[i].className = "hide_class"
            }
        }
        function hide_lugar_selector() {
            lugar_select.selectedIndex = lugar_select[0]
            // realiza con una condicio para su rompmiendo o continuacnion
            for (let i = 1; i < zona_select.length; i++) {
                zona_select[i].className = "hide_class"
            }
        }
    </script>
    <script>
        const form_elements_length = form.length
        let list_de_sitios = Array()
        let is_again_clicked = ""

        let selecteds = [0, 2, 3, 3]

        /*var b = form.getElementsByTagName('select')

        for (let i = 2; i < b.length; i++) {
            const element = b[i];
            element.disabled = true
        }

        b[1].addEventListener('change', function () {
            if (b[1].value != "") {
                b[2].disabled = false
            } else {
                for (let i = 2; i < b.length; i++) {
                    const element = b[i];
                    element.value = ""
                    element.disabled = true
                }
            }
        })
        b[2].addEventListener('change', function () {
            if (b[2].value != "") {
                b[3].disabled = false
            } else {
                for (let i = 2; i < b.length; i++) {
                    const element = b[i];
                    element.value = ""
                    element.disabled = true
                }
            }
        })*/

        function consoler() {
            var arr = ""
            var sear = "https://protonianosaurio.github.io/informacion/j_sons/"

            let llenos = 0
            while (form[llenos + 1].value != "") {
                const value = form[llenos].value
                sear += value + "/"
                arr += value
                if (llenos == 2) {
                    llenos += 1
                    break
                    ""
                }
                llenos += 1
            }

            if (llenos <= 2) {
                sear += (form[llenos].value + "/" + form[llenos].value + ".json")
            } else {
                sear += (form[llenos].value + ".json")
            }

            arr += form[llenos].value
            if (is_again_clicked !== arr) {
                is_again_clicked = arr

                const fechPromise = fetch(sear)
                fechPromise.then(response =>{
                    if(!response.ok){
                        throw new Error(response.status);
                    }
                    return response.json();
                }).then(json =>{
                    console.log(json)
                }).catch(error =>{
                    console.error(`Could not get products: ${error}`);
                })
            }
        }
        sender.addEventListener("click", consoler)

    </script>
    <script>

        const k = 40;
        const w = 16 * k;
        const h = 9 * k;
        const padding = 30;
        var database = [53, 64, 98, 74, 61, 34, 39, 10, 15, 160, 5];
        database = acomodador(database, 0);
        const svg = d3.select('#sas')
            .append("svg")
            .attr("width", w)
            .attr("height", h)
            .style("background", "rgb(125, 125, 255)")

        svg.selectAll("rect")
            .data(database)
            .enter()
            .append("rect")
            .attr("class", "bar")
            .attr("fill", "rgba(255, 255, 255, 0.5")
            .attr("width", 35)
            .attr("height", (d) => d * 1.5)
            .attr("x", (d, i) => i * 40 + padding + 60)
            .attr("y", (d) => h - (d * 1.5 + padding))
            .append("title")
            .text((d) => d)

        //svg.append("path")
        //    .attr("fill", "none")
        //    .attr("stroke", "black")
        //    .attr("stroke-width", 1.5)
        //    .attr("stroke-miterlimit", 1)
        //    .attr("d", masonte(database, h-30))

        svg.selectAll("text")
            .data(database)
            .enter()
            .append("text")
            .text((d) => d)
            .attr("x", (d, i) => {
                var ds = (d + "");
                if (ds.length >= 3) {
                    return i * 40 + padding + 5 + 60
                } else if (ds.length === 2) {
                    return i * 40 + padding + 10 + 60
                } else {
                    return i * 40 + padding + 16 + 60
                }
            })
            .attr("y", (d) => h - (d * 1.5 + padding) - 5)
    </script>
</body>

</html>